<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Select Profile - WAnjay</title>
  <script type="text/javascript" src="https://me.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=URt4Ml8UKu23uywksNY6qYUvRajxC1v33zXxNUZIDaU0UJ23kBjClRZXlQMpeAKr4PRFmQqQAKVJIKI2iOUUgdlHa4keDjQx0f8cEx8qAHXZ8j6wou26cXouENzQxAOcS52BE1f3PtEqYyPzsSlXydsejBK6vdPAxMI1I4qUF2IsoRphxpez5d0NKB2KVkxs2nSC4EDCa76T0PBNib5Ctl4xXgh56i4lORGOn7dN6giwKtZN6w62cSm7j3i2X7DU" charset="UTF-8"></script><style>
    :root {
      /* Updated minimal palette */
      --bg: #0f172a;
      --panel: #111827;
      --accent: #22c55e;
      --accent-2: #16a34a;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --error: #ef4444;
    }
    html, body { height: 100%; margin: 0; font-family: system-ui, Arial, sans-serif; color: var(--text); }
    body { background: transparent; display: flex; align-items: center; justify-content: center; }
    .card {
      width: 380px;
      background: #111827;
      border: 1px solid #1f2937;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .45);
      padding: 20px 22px 18px;
    }
    h2 {
      margin: 0 0 12px;
      font-size: 18px;
      font-weight: 600;
    }
    ul { list-style: none; padding: 0; margin: 0 0 12px; max-height: 200px; overflow-y: auto; }
    li { display: flex; align-items: center; margin: 4px 0; cursor: pointer; padding: 6px 0; border-radius: 6px; }
    li:hover { background: rgba(255,255,255,0.05); }
    li input[type=radio] { margin-right: 8px; }
    .field { margin-top: 12px; }
    input[type=text] {
      font-size: 15px;
      padding: 8px 10px;
      width: 100%;
      box-sizing: border-box;
      border-radius: 8px;
      border: 1px solid #1f2937;
      background: #0f172a;
      color: var(--text);
      outline: none;
    }
    input[type=text]:focus { border-color: #334155; box-shadow: 0 0 0 2px rgba(34, 197, 94, .15); }
    .actions { margin-top: 16px; display: flex; gap: 8px; }
    button {
      flex: 1;
      padding: 8px 10px;
      font-size: 14px;
      border: 0;
      border-radius: 8px;
      background: var(--accent);
      color: #04120a;
      font-weight: 600;
      cursor: pointer;
    }
    button:hover { background: var(--accent-2); }
    .msg { min-height: 1em; margin-top: 4px; font-size: 12px; color: var(--error); }
  </style>
</head>
<body>
  <div class="card">
    <h2 id="title">Pilih Profil</h2>
    <ul id="profile-list"></ul>
    <div class="field">
      <input id="new-profile" type="text" placeholder="Profil baru" />
      <div class="msg" id="err"></div>
    </div>
    <div class="actions">
      <button id="create-btn">Tambah</button>
      <button id="select-btn">Masuk</button>
    </div>
  </div>
  <script>
    (function() {
      const listEl = document.getElementById('profile-list');
      const newInput = document.getElementById('new-profile');
      const errEl = document.getElementById('err');
      const titleEl = document.getElementById('title');
      const createBtn = document.getElementById('create-btn');
      const selectBtn = document.getElementById('select-btn');
      let profiles = [];
      let selected = null;
      let lang = 'id';
      const translations = {
        en: {
          title: 'Select Profile',
          placeholder: 'New profile',
          add: 'Add',
          enter: 'Enter',
          nameEmpty: 'Name is required',
          profileExists: 'Profile already exists',
          createFailed: 'Failed to create profile',
          error: 'Error'
        },
        id: {
          title: 'Pilih Profil',
          placeholder: 'Profil baru',
          add: 'Tambah',
          enter: 'Masuk',
          nameEmpty: 'Nama tidak boleh kosong',
          profileExists: 'Profil sudah ada',
          createFailed: 'Gagal membuat profil',
          error: 'Error'
        }
      };
      function tr(key) {
        return (translations[lang] && translations[lang][key]) || key;
      }
      async function initLang() {
        try {
          const l = await window.langAPI.getLang();
          if (l === 'id' || l === 'en') lang = l;
        } catch (_) {}
        applyTranslations();
      }
      function applyTranslations() {
        titleEl.textContent = tr('title');
        newInput.placeholder = tr('placeholder');
        createBtn.textContent = tr('add');
        selectBtn.textContent = tr('enter');
        errEl.textContent = '';
      }
      function render() {
        listEl.innerHTML = '';
        profiles.forEach(name => {
          const li = document.createElement('li');
          const radio = document.createElement('input');
          radio.type = 'radio';
          radio.name = 'profile';
          radio.value = name;
          radio.checked = (selected === name);
          radio.addEventListener('change', () => {
            selected = name;
          });
          const label = document.createElement('span');
          label.textContent = name;
          li.appendChild(radio);
          li.appendChild(label);
          li.addEventListener('click', () => {
            selected = name;
            radio.checked = true;
          });
          listEl.appendChild(li);
        });
      }
      async function loadProfiles() {
        profiles = await window.profileAPI.getProfiles();
        if (!Array.isArray(profiles) || profiles.length === 0) {
          profiles = ['default'];
        }
        selected = profiles[0];
        render();
      }
      async function createProfile() {
        errEl.textContent = '';
        const name = newInput.value.trim();
        if (!name) { errEl.textContent = tr('nameEmpty'); return; }
        try {
          const res = await window.profileAPI.createProfile(name);
          if (!res.ok) { errEl.textContent = res.msg || tr('createFailed'); return; }
          profiles = res.profiles;
          selected = name;
          newInput.value = '';
          render();
        } catch (e) {
          errEl.textContent = tr('error');
        }
      }
      function selectProfile() {
        if (selected) {
          window.profileAPI.chooseProfile(selected);
        }
      }
      createBtn.addEventListener('click', createProfile);
      selectBtn.addEventListener('click', selectProfile);
      newInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') createProfile();
      });
      // Listen for language updates
      window.langAPI.onUpdate((l) => {
        if (l === 'id' || l === 'en') {
          lang = l;
          applyTranslations();
        }
      });
      // Initialise
      initLang();
      loadProfiles();
    })();
  </script>
</body>
</html>