<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WAnjay Lock</title>
  <style>
    :root{
      --bg:#0f172a; --panel:#111827; --accent:#22c55e; --accent-2:#16a34a; --text:#e5e7eb; --muted:#9ca3af; --error:#ef4444;
    }
    html,body{height:100%}
    body{font-family: system-ui, Arial, sans-serif; margin:0; background:transparent; color:var(--text);}
    .overlay{position:fixed; inset:0; background:rgba(3,7,18,.55); display:flex; align-items:center; justify-content:center}
    .card{width: 420px; background:linear-gradient(180deg, #0b1220, #0d1424); border:1px solid #1f2937; border-radius:14px; box-shadow:0 12px 40px rgba(0,0,0,.55); padding:22px 22px 18px}
    .title{display:flex; align-items:center; gap:8px; font-weight:700; letter-spacing:.3px; font-size:20px; margin-bottom:10px}
    .subtitle{font-size:13px; color:var(--muted); margin-bottom:12px}
    .field{margin:10px 0}
    input{font-size:16px;padding:10px 12px;width:100%;box-sizing:border-box;border-radius:10px;border:1px solid #1f2937;background:#0b1220;color:var(--text);outline:none}
    input:focus{border-color:#334155; box-shadow:0 0 0 2px rgba(34,197,94,.15)}
    .msg{color:var(--error);min-height:1.2em;margin:6px 0 0 2px;font-size:13px}
    .actions{margin-top:14px}
    button{padding:10px 12px;font-size:15px;width:100%;border:0;border-radius:10px;background:var(--accent);color:#04120a;font-weight:600;cursor:pointer}
    button:hover{background:var(--accent-2)}
  </style>
</head>
<body>
  <div class="overlay">
  <div class="card">
    <div class="title">WAnjay Lock</div>
    <div class="subtitle" id="mode">Enter PIN</div>
    <div class="field">
      <input id="pin" type="password" placeholder="PIN" autofocus />
      <div class="msg" id="msg"></div>
    </div>
    <div class="actions"><button id="ok">Unlock</button></div>
  </div>
  </div>
  <script>
    let setup=false;
    window.lockAPI.onState((p) => {
      setup = p.setup;
      document.getElementById('mode').innerText = setup ? 'Set PIN minimal 4 digit' : 'Enter PIN';
    });
    async function run(){
      const pin = document.getElementById('pin').value;
      try {
        if (setup) {
          const res = await window.lockAPI.setPin(pin);
          if (res.ok) { window.close(); }
          else { document.getElementById('msg').innerText = res.msg || 'Gagal set PIN'; }
        } else {
          const ok = await window.lockAPI.unlock(pin);
          if (!ok) { document.getElementById('msg').innerText = 'PIN salah'; }
        }
      } catch (e) {
        document.getElementById('msg').innerText = 'Error';
      }
    }
    document.getElementById('ok').onclick = run;
    document.getElementById('pin').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ run(); }});
  </script>
</body>
</html>
